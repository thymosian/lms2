'use client';

import React, { useState } from 'react';
import styles from '../CourseWizard.module.css';

interface QuizQuestion {
    question: string;
    options: string[];
    answer: number;
    type?: string;
}

interface Step6QuizReviewProps {
    data: any;
    quiz?: QuizQuestion[];
}

export default function Step6QuizReview({ data, quiz }: Step6QuizReviewProps) {
    const [expandedSection, setExpandedSection] = useState<string | null>('section-1');

    // Use generated quiz if available, otherwise fallback to empty or mock
    const questions = quiz || [];

    return (
        <div className={styles.stepWrapper}>
            <h2 className={styles.stepTitle}>Review Quiz Questions</h2>
            <p className={styles.stepSubtitle}>
                Review and edit the quiz questions generated by AI.
            </p>

            <div className={styles.quizReviewContainer}>
                {/* Header Row */}
                <div className={styles.quizHeaderRow}>
                    <div className={styles.quizHeaderLeft}>
                        <div className={styles.quizSectionTitle}>Editable quiz questions</div>
                        <div className={styles.quizSubtitle}>{questions.length} Questions Generated</div>
                    </div>
                    <button className={styles.btnRegenerate}>
                        Regenerate Quiz
                    </button>
                </div>

                {/* Flat Question List */}
                <div className={styles.questionListWrapper}>
                    {questions.length === 0 ? (
                        <div className={styles.emptyState}>
                            No questions generated. Please go back and regenerate the course.
                        </div>
                    ) : (
                        questions.map((q, index) => (
                            <div key={index} className={styles.questionCard}>
                                <div className={styles.questionHeader}>
                                    <div className={styles.questionText}>
                                        <span style={{ fontWeight: 'bold', marginRight: 8 }}>{index + 1}.</span>
                                        {q.question}
                                        {q.type && (
                                            <span style={{
                                                marginLeft: 10,
                                                fontSize: 11,
                                                padding: '2px 6px',
                                                borderRadius: 4,
                                                background: q.type === 'true_false' ? '#E9D8FD' : '#EBF8FF',
                                                color: q.type === 'true_false' ? '#6B46C1' : '#3182CE',
                                                textTransform: 'capitalize'
                                            }}>
                                                {q.type.replace('_', ' ')}
                                            </span>
                                        )}
                                    </div>
                                    <button className={styles.btnEdit}>Edit</button>
                                </div>
                                <div className={styles.optionList}>
                                    {q.options.map((opt, optIndex) => (
                                        <div key={optIndex} className={styles.optionItem}>
                                            <div
                                                className={`${styles.radioCircle} ${q.answer === optIndex ? styles.radioSelected : ''}`}
                                                style={q.answer === optIndex ? { background: '#48BB78', borderColor: '#48BB78' } : {}}
                                            />
                                            {opt}
                                            {q.answer === optIndex && <span style={{ marginLeft: 8, fontSize: 12, color: '#48BB78', fontWeight: 600 }}>(Correct)</span>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))
                    )}
                </div>
            </div>
        </div>
    );
}
